<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>CHIE-NO-WA Editor: Lanota Edition</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <style>
        html {
            height: 100%;
        }

        body {
            -webkit-text-size-adjust: 100%;
        }

        .hidden {
            display: none;
        }

        .play-area {
            position: relative;
        }

        svg.preview {
            position: absolute;
            width: auto;
            height: auto;
            max-width: 100%;
            max-width: 100%;
        }
        
        .combo {
            text-anchor: middle;
            dominant-baseline: central;
            background-color: #aaa;
            font-feature-settings: palt;
            font-variant-numeric: oldstyle-nums;
            -moz-font-feature-settings: onum;
            -webkit-font-feature-settings: onum;
            font-feature-settings: onum
        }
        
        .score {
            font-family: Avenir Next;
            dominant-baseline: central;
            background-color: #aaa;
            font-feature-settings: palt;
            font-variant-numeric: oldstyle-nums;
            -moz-font-feature-settings: onum;
            -webkit-font-feature-settings: onum;
            font-feature-settings: onum
        }

        thead {
            display: block;
        }

        tbody {
            display: block;
            overflow-y: scroll;
        }

        .number {
            min-width: 20px;
        }

        .name {
            min-width: 80px;
        }

        .value {
            min-width: 180px;
        }

        .button {
            min-width: 180px;
        }

        .description {
            width: 10000px;
        }
    </style>
    <script>
        // キーボードショートカットの判定
        document.addEventListener('keydown', event => {
            var active = document.activeElement;
            if (active.tagName == 'INPUT' || active.tagName == 'TEXTAREA' || event.code === 'Tab') {
                return false
            } else {
                event.preventDefault();
            };

            var before = '';
            var after = '';

            if (event.code === 'KeyQ' && !event.ctrlKey) {
                document.getElementById('btn-touch').click();
                updatePreviewTemp();
            };

            if (event.code === 'KeyW' && !event.ctrlKey) {
                document.getElementById('btn-holds').click();
                updatePreviewTemp();
            };

            if (event.code === 'KeyH' && !event.ctrlKey) {
                if (document.getElementById('btn-hold-a').checked){
                    document.getElementById('btn-hold-b').click();

                } else if (document.getElementById('btn-hold-b').checked) {
                    document.getElementById('btn-hold-c').click();

                } else if (document.getElementById('btn-hold-c').checked) {
                    document.getElementById('btn-hold-d').click();

                } else if (document.getElementById('btn-hold-d').checked) {
                    document.getElementById('btn-hold-e').click();

                } else if (document.getElementById('btn-hold-e').checked) {
                    document.getElementById('btn-hold-a').click();
                };
                
                updatePreviewTemp();
            };

            if (event.code === 'KeyE' && !event.ctrlKey) {
                document.getElementById('btn-holde').click();
                updatePreviewTemp();
            };

            if (event.code === 'KeyR' && !event.ctrlKey) {
                document.getElementById('btn-chain').click();
                updatePreviewTemp();
            };

            if (event.code === 'KeyT' && !event.ctrlKey) {
                document.getElementById('btn-left').click();
                updatePreviewTemp();
            };

            if (event.code === 'KeyY' && !event.ctrlKey) {
                document.getElementById('btn-right').click();
                updatePreviewTemp();
            };

            if (event.code === 'KeyU' && !event.ctrlKey) {
                document.getElementById('btn-in').click();
                updatePreviewTemp();
            };

            if (event.code === 'KeyI' && !event.ctrlKey) {
                document.getElementById('btn-out').click();
                updatePreviewTemp();
            };

            if (event.code === 'KeyA' && !event.ctrlKey) {
                adjustWidth(-5);
                document.getElementById('btn-width-dl').focus();
            };

            if (event.code === 'KeyS' && !event.ctrlKey) {
                adjustWidth(-1);
                document.getElementById('btn-width-ds').focus();
            };

            if (event.code === 'KeyD' && !event.ctrlKey) {
                adjustWidth(1);
                document.getElementById('btn-width-is').focus();
            };

            if (event.code === 'KeyF' && !event.ctrlKey) {
                adjustWidth(5);
                document.getElementById('btn-width-il').focus();
            };

            if (event.code === 'KeyJ' && !event.ctrlKey) {
                adjustRotate(30);
                document.getElementById('btn-rotate-dl').focus();
            };

            if (event.code === 'KeyK' && !event.ctrlKey) {
                adjustRotate(6);
                document.getElementById('btn-rotate-ds').focus();
            };

            if (event.code === 'KeyL' && !event.ctrlKey) {
                adjustRotate(-6);
                document.getElementById('btn-rotate-is').focus();
            };

            if (event.code === 'Semicolon' || event.code === 'Colon') {
                adjustRotate(-30);
                document.getElementById('btn-rotate-il').focus();
            };

            if (event.code === 'Comma' && !event.ctrlKey) {
                adjustRotateFlip();
                document.getElementById('btn-rotate-fl').focus();
            };

            if (event.code === 'Period' && !event.ctrlKey) {
                adjustRotate(180);
                document.getElementById('btn-rotate-ud').focus();
            };

            if (event.code === 'Slash' && !event.ctrlKey) {
                adjustRotate0();
                document.getElementById('btn-rotate-0').focus();
            };

            if (event.code === 'Minus' && !event.ctrlKey) {
                if (document.getElementById('btn-seek-for').checked){
                    document.getElementById('btn-seek-back').click();
                } else {
                    document.getElementById('btn-seek-for').click();
                };
            };

            if (event.code === 'Digit1') {
                seekTime(4, 4);
                document.getElementById('btn-seek-4').focus();
            };

            if (event.code === 'Digit2') {
                seekTime(4, 8);
                document.getElementById('btn-seek-8').focus();
            };

            if (event.code === 'Digit3') {
                seekTime(4, 16);
                document.getElementById('btn-seek-16').focus();
            };

            if (event.code === 'Digit4') {
                seekTime(4, 32);
                document.getElementById('btn-seek-3').focus();
            };

            if (event.code === 'Digit5') {
                seekTime(4, 3);
                document.getElementById('btn-seek-3').focus();
            };

            if (event.code === 'Digit6') {
                seekTime(4, 6);
                document.getElementById('btn-seek-6').focus();
            };

            if (event.code === 'Digit7') {
                seekTime(4, 12);
                document.getElementById('btn-seek-12').focus();
            };

            if (event.code === 'Digit8') {
                seekTime(4, 24);
                document.getElementById('btn-seek-24').focus();
            };

            if (event.code === 'Digit9') {
                seekTime(4, 7);
                document.getElementById('btn-seek-7').focus();
            };

            if (event.code === 'Digit0') {
                seekTime(4, 14);
                document.getElementById('btn-seek-14').focus();
            };

            if (event.code === 'ArrowDown') {
                seekTimeDetail(-0.001);
                document.getElementById('btn-seek-ds').focus();
            };

            if (event.code === 'ArrowUp') {
                seekTimeDetail(0.001);
                document.getElementById('btn-seek-is').focus();
            };

            if (event.code === 'ArrowLeft') {
                seekTimeDetail(-0.1);
                document.getElementById('btn-seek-dl').focus();
            };

            if (event.code === 'ArrowRight') {
                seekTimeDetail(0.1);
                document.getElementById('btn-seek-il').focus();
            };

            if (event.code === 'Space') {
                insertNote();
                document.getElementById('btn-insert').focus();
            };

            if (event.code === 'Space' && event.shiftKey) {
                copyLastNote();
                document.getElementById('btn-copy').focus();
            };

            if (event.code === 'Backspace') {
                deleteNote();
                document.getElementById('btn-delete').focus();
            };

            if (event.code === 'Enter') {
                applyInserts();
                document.getElementById('btn-apply').focus();
            };

            if (event.code === 'KeyT' && event.ctrlKey) {
                document.getElementById('ipt-bpm').focus();
            };

            if (event.code === 'KeyI' && event.ctrlKey) {
                document.getElementById('ipt-play-url').focus();
            };

            if (event.code === 'KeyB' && event.ctrlKey) {
                document.getElementById('ipt-play-begin').focus();
            };

            if (event.code === 'KeyD' && event.ctrlKey) {
                document.getElementById('ipt-play-dur').focus();
            };

            if (event.code === 'KeyN' && event.ctrlKey) {
                document.getElementById('ipt-duration').focus();
            };

            if (event.code === 'KeyO' && event.ctrlKey) {
                document.getElementById('ipt-offset').focus();
            };

            if (event.code === 'KeyP' && event.ctrlKey) {
                document.getElementById('btn-play').focus();
                playVideo();
            };
        });

        // 時間のジャンプ
        function jumpTime(time, notes){
            let target = document.getElementById('ipt-time');
            let targetDetail = document.getElementById('ipt-time-detail');

            target.value = String(time);
            targetDetail.value = String(time);

            let srcNotes = String(`${notes}    `).split(' ');
            const notesList = ['ipt-note-1', 'ipt-note-2', 'ipt-note-3', 'ipt-note-4', 'ipt-note-5'];

            notesList.forEach(function(n, i){
                let note = document.getElementById(n);
                note.value = srcNotes[i];
                if (note.value != '') note.classList.add('alert-primary');
            });

            updatePreview();
        };

        // 動画の再生
        function playVideo(){
            let url = document.getElementById('ipt-play-url').value;
            let start = document.getElementById('ipt-play-begin').value;
            let end = Number(start) + Number(document.getElementById('ipt-play-dur').value);

            player.loadVideoById({'videoId': url,
               'startSeconds': start,
               'endSeconds': end,
               'suggestedQuality': 'small'});
        };

        // iframeのリロード
        function reloadFrame(){
            var frame_id = 'ifr-player';
            if(window.document.getElementById(frame_id).location ) {  
                window.document.getElementById(frame_id).location.reload(true);
            } else if (window.document.getElementById(frame_id).contentWindow.location ) {
                window.document.getElementById(frame_id).contentWindow.location.reload(true);
            } else if (window.document.getElementById(frame_id).src){
                window.document.getElementById(frame_id).src = window.document.getElementById(frame_id).src;
            };
        }

        // 拍子の長さを取得
        function getBeatDuration(){
            let bpm = Number(document.getElementById('ipt-bpm').value);
            document.getElementById('ipt-beat-dur').value = Number(60 / bpm).toFixed(3);
            let beat = Number(document.getElementById('ipt-beat').value);
            document.getElementById('ipt-measure-dur').value = Number((60 / bpm) * beat).toFixed(3);
        };


        function adjustDuration(operand){
            let dur = document.getElementById('ipt-duration');
            before = dur.value;
            after =  Number(Number(dur.value) + operand);
            if (after < 0.001) after = Number(0.001);
            if (Number.isNaN(after)) after = 0.750;
            dur.value = Number(after).toFixed(3);
            pushHitsory(`ノート落下時間: ${dur.value} ← ${before}`);
        };

        function adjustOffset(operand){
            let offset = document.getElementById('ipt-offset');
            before = offset.value;
            after =  Number(Number(offset.value) + operand);
            if (Number.isNaN(after)) after = 0.0;
            offset.value = Number(after).toFixed(3);
            pushHitsory(`ノート落下タイミング: ${offset.value} ← ${before}`);
        };

        // BPMの変更
        function adjustBpm(operand){
            let bpm = document.getElementById('ipt-bpm');
            before = bpm.value;
            after =  Number(Number(bpm.value) + operand);
            if (after < 1) after = Number(1);
            if (Number.isNaN(after)) after = 1;
            bpm.value = Number(after);
            getBeatDuration();
            pushHitsory(`BPM: ${bpm.value} ← ${before}`);
        };

        // 拍数の変更
        function adjustBeat(operand){
            let beat = document.getElementById('ipt-beat');
            before = beat.value;
            after =  Number(Number(beat.value) + operand);
            if (after < 1) after = Number(1);
            if (Number.isNaN(after)) after = 1;
            beat.value = Number(after);
            getBeatDuration();
        };

        function searchFrame(){
            let returnValue = -1;
            let rows =  document.querySelectorAll('tr');
                rows.forEach(function(e, i){
                    if (e.querySelector('.name').innerHTML == document.getElementById('ipt-time').value) returnValue = i;
                });

            return returnValue;
        };
        
        function updateFrame(index){
            let row =  document.querySelectorAll('tr')[index];
            let value = row.querySelector('.value');
            value.innerHTML = getTimelineHtmlUpdate();
            
            let button = row.querySelector('.button .btn-sm');
            let time = document.getElementById('ipt-time').value;
            let notesCode = getNotesCode();
            button.setAttribute('onclick', `jumpTime('${time}', '${notesCode}')`);
        };

        function applyInserts(){
            if (checkNoteExists()){
                if (searchFrame() == -1){
                    document.getElementById('tbl-notes').insertAdjacentHTML('afterbegin', getTimelineHtml());
                    deleteNoteAll();
                    pushHitsory(`フレーム挿入: ${document.getElementById('ipt-time').value}`);
                } else {
                    let arg = searchFrame();
                    updateFrame(arg);
                    deleteNoteAll();
                    pushHitsory(`フレーム変更: ${document.getElementById('ipt-time').value}`);
                };
            };
        };

        function switchSeekButton(direction){
            if (direction == 'forward'){
                document.querySelectorAll('.backward').forEach(function(e){
                    e.style = "display: none";
                });

                document.querySelectorAll('.forward').forEach(function(e){
                    e.style = "";
                });
            };

            if (direction == 'backward'){
                document.querySelectorAll('.forward').forEach(function(e){
                    e.style = "display: none"
                });

                document.querySelectorAll('.backward').forEach(function(e){
                    e.style = "";
                });
            };
        };

        // 時間の変更
        function seekTime(num, denom){
            if (checkNoteExists()){
                if (searchFrame() == -1){
                    document.getElementById('tbl-notes').insertAdjacentHTML('afterbegin', getTimelineHtml());
                    deleteNoteAll();
                    pushHitsory(`フレーム挿入: ${document.getElementById('ipt-time').value}`);
                } else {
                    let arg = searchFrame()
                    updateFrame(arg);
                    deleteNoteAll();
                    pushHitsory(`フレーム変更: ${document.getElementById('ipt-time').value}`);
                };
            };

            let isForward = document.getElementById('btn-seek-for').checked;
            let time = document.getElementById('ipt-time');
            let timeDetail = document.getElementById('ipt-time-detail');
            let bpm = Number(document.getElementById('ipt-bpm').value);

            before = time.value;

            if (isForward){
                timeDetail.value = Number(Number(timeDetail.value) + Number(60 / bpm / denom) * Number(num));
                time.value = Number(timeDetail.value).toFixed(3);
                
            } else {
                timeDetail.value = Number(Number(timeDetail.value) - Number(60 / bpm / denom) * Number(num));
                time.value = Number(timeDetail.value).toFixed(3);
            };

            pushHitsory(`時間: ${time.value} ← ${before}`);
        };

        // 時間の詳細変更
        function seekTimeDetail(operand){
            if (checkNoteExists()){
                if (searchFrame() == -1){
                    document.getElementById('tbl-notes').insertAdjacentHTML('afterbegin', getTimelineHtml());
                    deleteNoteAll();
                    pushHitsory(`フレーム挿入: ${document.getElementById('ipt-time').value}`);
                } else {
                    let arg = searchFrame()
                    updateFrame(arg);
                    deleteNoteAll();
                    pushHitsory(`フレーム変更: ${document.getElementById('ipt-time').value}`);
                };
            };

            before = document.getElementById('ipt-time').value;
            document.getElementById('ipt-time-detail').value = Number(Number(document.getElementById('ipt-time-detail').value) + operand);
            document.getElementById('ipt-time').value = Number(document.getElementById('ipt-time-detail').value).toFixed(3);
            pushHitsory(`時間: ${document.getElementById('ipt-time').value} ← ${before}`);
            deleteNoteAll();
        };

        // ノート角度の変更
        function adjustPlayBegin(operand){
            let begin = document.getElementById('ipt-play-begin');
            before = begin.value;
            after =  Number(Number(begin.value) + operand);
            if (Number.isNaN(after)) after = 0;
            begin.value = Number(after);
            updatePreviewTemp();
        };

        // ノート角度の変更
        function adjustPlayDur(operand){
            let dur = document.getElementById('ipt-play-dur');
            before = dur.value;
            after =  Number(Number(dur.value) + operand);
            if (Number.isNaN(after)) after = 0;
            dur.value = Number(after);
            updatePreviewTemp();
        };

        // ノート角度の変更
        function adjustRotate(operand){
            let rotate = document.getElementById('ipt-rotate');
            before = rotate.value;
            after =  Number(Number(rotate.value) + operand);
            if (after > 180) after = Number(Number(after) - 360);
            if (after < -180) after = Number(Number(after) + 360);
            if (Number.isNaN(after)) after = 0;
            rotate.value = Number(after);
            pushHitsory(`角度: ${after} ← ${before}`);
            updatePreviewTemp();
        };

        function adjustRotateByInput(input){
            let rotate = document.getElementById('ipt-rotate');
            after =  input;
            if (after > 180) after = Number(Number(after) - 360);
            if (after < -180) after = Number(Number(after) + 360);
            if (Number.isNaN(after)) after = 0;
            rotate.value = Number(after);
            pushHitsory(`角度: ${after}`);
            updatePreviewTemp();
        };

        // ノート角度の左右反転
        function adjustRotateFlip(){
            let rotate = document.getElementById('ipt-rotate');
            before = rotate.value;
            after =  Number(Number(rotate.value) * -1);
            if (after > 180) after = Number(Number(after) - 360);
            if (after < -180) after = Number(Number(after) + 360);
            if (Number.isNaN(after)) after = 0;
            rotate.value = Number(after);
            pushHitsory(`角度: ${after} ← ${before}`);
            updatePreviewTemp();
        };

        // ノート角度の初期化
        function adjustRotate0(){
            let rotate = document.getElementById('ipt-rotate');
            before = rotate.value;
            after =  Number('0');
            if (after > 180) after = Number(Number(after) - 360);
            if (after < -180) after = Number(Number(after) + 360);
            if (Number.isNaN(after)) after = 0;
            rotate.value = Number(after);
            pushHitsory(`角度: ${after} ← ${before}`);
            updatePreviewTemp();
        };

        // ノート幅の変更
        function adjustWidth(operand){
            let width = document.getElementById('ipt-width');
            before = width.value;
            after =  Number(Number(width.value) + operand);
            if (after > 60) after = Number('60');
            if (after < 4) after = Number('4');
            if (Number.isNaN(after)) after = Number('4');
            width.value = after;
            pushHitsory(`幅: ${after} ← ${before}`);
            updatePreviewTemp();
        };

        // ノート幅の変更
        function adjustWidthByInput(number){
            let width = document.getElementById('ipt-width');
            after = number;
            if (after > 60) after = Number('60');
            if (after < 4) after = Number('4');
            if (Number.isNaN(after)) after = Number('4');
            width.value = after;
            pushHitsory(`幅: ${after}`);
            updatePreviewTemp();
        };

        // ノートを配置
        function insertNote(){
            let note = '';
            if (document.getElementById('btn-touch').checked) note = 'touch';
            if (document.getElementById('btn-holds').checked){
                if (document.getElementById('btn-hold-a').checked){
                    note = 'holdsa';
                
                } else if (document.getElementById('btn-hold-b').checked){
                    note = 'holdsb';
                
                } else if (document.getElementById('btn-hold-c').checked){
                    note = 'holdsc';
                
                } else if (document.getElementById('btn-hold-d').checked){
                    note = 'holdsd';
                
                } else if (document.getElementById('btn-hold-e').checked){
                    note = 'holdse';
                }
            };
            if (document.getElementById('btn-holde').checked){
                if (document.getElementById('btn-hold-a').checked){
                    note = 'holdea';
                
                } else if (document.getElementById('btn-hold-b').checked){
                    note = 'holdeb';
                
                } else if (document.getElementById('btn-hold-c').checked){
                    note = 'holdec';
                
                } else if (document.getElementById('btn-hold-d').checked){
                    note = 'holded';
                
                } else if (document.getElementById('btn-hold-e').checked){
                    note = 'holdee';
                }
            };
            if (document.getElementById('btn-chain').checked) note = 'chain';
            if (document.getElementById('btn-left').checked) note = 'left';
            if (document.getElementById('btn-right').checked) note = 'right';
            if (document.getElementById('btn-in').checked) note = 'in';
            if (document.getElementById('btn-out').checked) note = 'out';
            
            let width = document.getElementById('ipt-width').value;
            let rotate = document.getElementById('ipt-rotate').value;
            let val = `${note}-${width}-${rotate}`;

            if (document.getElementById('ipt-note-1').value == ''){
                document.getElementById('ipt-note-1').value = val;
                document.getElementById('ipt-note-1').classList.add('alert-primary');
                pushHitsory(`ノート挿入(1): ${val}`);

            } else if (document.getElementById('ipt-note-2').value == ''){
                if (document.getElementById('ipt-note-1').value != val){
                    document.getElementById('ipt-note-2').value = val;
                    document.getElementById('ipt-note-2').classList.add('alert-primary');
                    pushHitsory(`ノート挿入(2): ${val}`);
                };

            } else if (document.getElementById('ipt-note-3').value == ''){
                if (document.getElementById('ipt-note-2').value != val){
                    document.getElementById('ipt-note-3').value = val;
                    document.getElementById('ipt-note-3').classList.add('alert-primary');
                    pushHitsory(`ノート挿入(3): ${val}`);
                };

            } else if (document.getElementById('ipt-note-4').value == ''){
                if (document.getElementById('ipt-note-3').value != val){
                    document.getElementById('ipt-note-4').value = val;
                    document.getElementById('ipt-note-4').classList.add('alert-primary');
                    pushHitsory(`ノート挿入(4): ${val}`);
                };

            } else {
                if (document.getElementById('ipt-note-4').value != val){
                    document.getElementById('ipt-note-5').value = val;
                    document.getElementById('ipt-note-5').classList.add('alert-primary');
                    pushHitsory(`ノート挿入(5): ${val}`);
                };
            };

            updatePreview();
        };

        // 最後のノートを削除
        function deleteNote(){
            if (document.getElementById('ipt-note-5').value != ''){
                pushHitsory(`ノート削除(5): ${document.getElementById('ipt-note-5').value}`);
                document.getElementById('ipt-note-5').value = '';
                document.getElementById('ipt-note-5').classList.remove('alert-primary');
                document.getElementById('ipt-note-5').classList.remove('alert-success');

            } else if (document.getElementById('ipt-note-4').value != ''){
                pushHitsory(`ノート削除(4): ${document.getElementById('ipt-note-4').value}`);
                document.getElementById('ipt-note-4').value = '';
                document.getElementById('ipt-note-4').classList.remove('alert-primary');
                document.getElementById('ipt-note-4').classList.remove('alert-success');

            } else if (document.getElementById('ipt-note-3').value != ''){
                pushHitsory(`ノート削除(3): ${document.getElementById('ipt-note-3').value}`);
                document.getElementById('ipt-note-3').value = '';
                document.getElementById('ipt-note-3').classList.remove('alert-primary');
                document.getElementById('ipt-note-3').classList.remove('alert-success');

            } else if (document.getElementById('ipt-note-2').value != ''){
                pushHitsory(`ノート削除(2): ${document.getElementById('ipt-note-2').value}`);
                document.getElementById('ipt-note-2').value = '';
                document.getElementById('ipt-note-2').classList.remove('alert-primary');
                document.getElementById('ipt-note-2').classList.remove('alert-success');

            } else {
                if (document.getElementById('ipt-note-1').value != ''){
                    pushHitsory(`ノート削除(1): ${document.getElementById('ipt-note-1').value}`);
                    document.getElementById('ipt-note-1').value = '';
                    document.getElementById('ipt-note-1').classList.remove('alert-primary');
                    document.getElementById('ipt-note-1').classList.remove('alert-success');
                };
            };

            updatePreview();
        };

        // 全てのノートを削除
        function deleteNoteAll(){
            const notes = ['ipt-note-1', 'ipt-note-2', 'ipt-note-3', 'ipt-note-4', 'ipt-note-5'];
            const previews = ['svg-note-1', 'svg-note-2', 'svg-note-3', 'svg-note-4', 'svg-note-5'];

            notes.forEach(function(n, i){
                var note = document.getElementById(n);
                var target = document.getElementById(previews[i]);

                note.value = '';
                note.classList.remove('alert-primary');
                note.classList.remove('alert-success');
                target.setAttribute('href', '');
                target.setAttribute('transform', 'rotate(0)');
            });
        };

        function checkNoteExists(){
            const notes = ['ipt-note-1', 'ipt-note-2', 'ipt-note-3', 'ipt-note-4', 'ipt-note-5'];
            var returnValue = false;

            notes.forEach(function(n){
                let note = document.getElementById(n);
                if (note.value != '') returnValue = true;
            });

            return returnValue;
        };

        // プレビューの更新
        function updatePreview(){
            const notes = ['ipt-note-1', 'ipt-note-2', 'ipt-note-3', 'ipt-note-4', 'ipt-note-5'];
            const previews = ['svg-note-1', 'svg-note-2', 'svg-note-3', 'svg-note-4', 'svg-note-5'];

            notes.forEach(function(n, i){
                var note = document.getElementById(n);
                var target = document.getElementById(previews[i]);

                if (note.value != ''){
                    let delimiterCount = String(note.value).match(/-/g).length;

                    if (delimiterCount == 2 || delimiterCount == 3){
                        let noteId = String(note.value).match(/^[a-z]+-[0-9]+/g);
                        let noteRotate = String(note.value).replace(`${noteId}-`, '');

                        if (String(noteId).indexOf('hold') != -1){
                            noteId = String(noteId).replace('sa', '');
                            noteId = String(noteId).replace('sb', '');
                            noteId = String(noteId).replace('sc', '');
                            noteId = String(noteId).replace('sd', '');
                            noteId = String(noteId).replace('se', '');
                            noteId = String(noteId).replace('ea', '');
                            noteId = String(noteId).replace('eb', '');
                            noteId = String(noteId).replace('ec', '');
                            noteId = String(noteId).replace('ed', '');
                            noteId = String(noteId).replace('ee', '');
                        };

                        target.setAttribute('href', `#${noteId}`);
                        target.setAttribute('transform', `rotate(${noteRotate})`);
                    };
                } else {
                    target.setAttribute('href', '');
                    target.setAttribute('transform', 'rotate(0)');
                };
            });
        };

        function updatePreviewTemp(){
            let target = document.getElementById('svg-note-temp');
            let note = '';

            if (document.getElementById('btn-touch').checked) note = 'touch';
            if (document.getElementById('btn-holds').checked) note = 'hold';
            if (document.getElementById('btn-holde').checked) note = 'hold';
            if (document.getElementById('btn-chain').checked) note = 'chain';
            if (document.getElementById('btn-left').checked) note = 'left';
            if (document.getElementById('btn-right').checked) note = 'right';
            if (document.getElementById('btn-in').checked) note = 'in';
            if (document.getElementById('btn-out').checked) note = 'out';
            
            let width = document.getElementById('ipt-width').value;
            let rotate = document.getElementById('ipt-rotate').value;

            target.setAttribute('href', `#${note}-${width}`);
            target.setAttribute('transform', `rotate(${rotate})`);
        };


        function getNotesCode(){
            const notes = ['ipt-note-1', 'ipt-note-2', 'ipt-note-3', 'ipt-note-4', 'ipt-note-5'];
            let returnValue = ''; 

            notes.forEach(function(n){
                let note = document.getElementById(n);
                if (note.value != '') returnValue += `${note.value} `;
            });

            return returnValue;
        };

        function getTimelineHtml(){
            const notes = ['ipt-note-1', 'ipt-note-2', 'ipt-note-3', 'ipt-note-4', 'ipt-note-5'];
            let returnValue = ''; 

            notes.forEach(function(n){
                let note = document.getElementById(n);
                if (note.value != '') returnValue += `${note.value} `;
            });

            let nextNumber = 1;
            if (document.querySelector('td.number') !== null){
                nextNumber = Number(document.querySelector('td.number').innerText) + 1;
            };
            
            let noteIconHtml = '';
            if (String(returnValue).match(/touch/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -16 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="deeppink" />
                </svg>`
            };
            
            if (String(returnValue).match(/holds/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -64 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="olive" />
                    <rect x="-24" y="-64" width="48" height="96" fill="orange" />
                </svg>`
            };

            if (String(returnValue).match(/holdv/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -64 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="olive" />
                </svg>`
            };

            if (String(returnValue).match(/holde/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -64 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="olive" />
                </svg>`
            };

            if (String(returnValue).match(/chain/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -16 64 128" width="10" height="20">
                    <line x1="-32" y1="48" x2="32" y2="48" stroke="gold" stroke-width="32"/>
                    <line x1="-32" y1="48" x2="32" y2="48" stroke="olive" stroke-width="32" stroke-dasharray="16 8" />
                </svg>`
            };

            if (String(returnValue).match(/left/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="orange" />
                    <polyline points="20,-24 -20,0 20,24" stroke="orange" stroke-width="16" fill="none" />
                </svg>`
            };

            if (String(returnValue).match(/right/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="limegreen" />
                    <polyline points="-20,-24 20,0 -20,24" stroke="limegreen" stroke-width="16" fill="none" />
                </svg>`
            };

            if (String(returnValue).match(/^in/g) || String(returnValue).match(/;in/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="orangered" />
                    <polyline points="-32,0 0,-28 32,0" stroke="orangered" stroke-width="16" fill="none" />
                    <polyline points="-32,28 0,0 32,28" stroke="orangered" stroke-width="16" fill="none" />
                </svg>`
            };

            if (String(returnValue).match(/out/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="dodgerblue" />
                    <polyline points="-32,-28 0,0 32,-28" stroke="dodgerblue" stroke-width="16" fill="none" />
                    <polyline points="-32,0 0,28 32,0" stroke="dodgerblue" stroke-width="16" fill="none" />
                </svg>`
            };
            let time = document.getElementById('ipt-time').value;
            let notesCode = getNotesCode();

            returnValue = `
                <tr id="tr-note-${nextNumber}">
                    <td class="number">${nextNumber}</td>
                    <td class="name">${time}</td>
                    <td class="value">${noteIconHtml} ${returnValue}</td>
                    <td class="button">
                        <button class="btn btn-outline-secondary btn-sm" type="button" onclick="jumpTime('${time}', '${notesCode}')">変更</button>
                        <button class="btn btn-outline-danger btn-sm" type="button" onclick="javascript:document.getElementById('tr-note-${nextNumber}').remove()">削除</button>
                    </td>
                </tr>`;

            return returnValue;
        };

        function getTimelineHtmlUpdate(){
            const notes = ['ipt-note-1', 'ipt-note-2', 'ipt-note-3', 'ipt-note-4', 'ipt-note-5'];
            let returnValue = ''; 

            notes.forEach(function(n){
                let note = document.getElementById(n);
                if (note.value != '') returnValue += `${note.value} `;
            });

            let nextNumber = 1;
            if (document.querySelector('td.number') !== null){
                nextNumber = Number(document.querySelector('td.number').innerText) + 1;
            };
            
            let noteIconHtml = '';
            if (String(returnValue).match(/touch/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -16 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="deeppink" />
                </svg>`
            };
            
            if (String(returnValue).match(/holds/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -64 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="olive" />
                    <rect x="-24" y="-64" width="48" height="96" fill="orange" />
                </svg>`
            };

            if (String(returnValue).match(/holdv/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -64 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="olive" />
                </svg>`
            };

            if (String(returnValue).match(/holde/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -64 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="olive" />
                </svg>`
            };

            if (String(returnValue).match(/chain/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -16 64 128" width="10" height="20">
                    <line x1="-32" y1="48" x2="32" y2="48" stroke="gold" stroke-width="32"/>
                    <line x1="-32" y1="48" x2="32" y2="48" stroke="olive" stroke-width="32" stroke-dasharray="16 8" />
                </svg>`
            };

            if (String(returnValue).match(/left/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="orange" />
                    <polyline points="20,-24 -20,0 20,24" stroke="orange" stroke-width="16" fill="none" />
                </svg>`
            };

            if (String(returnValue).match(/right/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="limegreen" />
                    <polyline points="-20,-24 20,0 -20,24" stroke="limegreen" stroke-width="16" fill="none" />
                </svg>`
            };

            if (String(returnValue).match(/^in/g) || String(returnValue).match(/;in/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="orangered" />
                    <polyline points="-32,0 0,-28 32,0" stroke="orangered" stroke-width="16" fill="none" />
                    <polyline points="-32,28 0,0 32,28" stroke="orangered" stroke-width="16" fill="none" />
                </svg>`
            };

            if (String(returnValue).match(/out/g)){
                noteIconHtml += `
                <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                    <rect x="-32" y="32" width="64" height="32" fill="dodgerblue" />
                    <polyline points="-32,-28 0,0 32,-28" stroke="dodgerblue" stroke-width="16" fill="none" />
                    <polyline points="-32,0 0,28 32,0" stroke="dodgerblue" stroke-width="16" fill="none" />
                </svg>`
            };
            let time = document.getElementById('ipt-time').value;
            let notesCode = getNotesCode();

            returnValue = `${noteIconHtml} ${returnValue}`;

            return returnValue;
        };

        // 最後のフレームをコピー
        function copyLastNote(){
            let lastNotes = String(`${document.querySelector('td.value').innerText}    `).split(' ');
            const notes = ['ipt-note-1', 'ipt-note-2', 'ipt-note-3', 'ipt-note-4', 'ipt-note-5'];

            notes.forEach(function(n, i){
                let note = document.getElementById(n);

                note.value = lastNotes[i + 1];
                if (note.value != '') note.classList.add('alert-success');
            });
        };

        // 履歴の表示
        function pushHitsory(value){
            document.getElementById('ipt-hist-5').value = document.getElementById('ipt-hist-4').value;
            document.getElementById('ipt-hist-4').value = document.getElementById('ipt-hist-3').value;
            document.getElementById('ipt-hist-3').value = document.getElementById('ipt-hist-2').value;
            document.getElementById('ipt-hist-2').value = document.getElementById('ipt-hist-1').value;
            document.getElementById('ipt-hist-1').value = value;
        };

        function exportNotesData(){
            let rows =  document.querySelectorAll('tr');
            let data = [];
            let result = document.getElementById('ipt-note-data');
            let tmp = '';

            for (i = rows.length - 1; i >= 0; i--){
                let e = rows[i];
                
                if (i > 0){
                    let dur = Number(document.getElementById('ipt-duration').value);
                    let offset = Number(document.getElementById('ipt-offset').value);
                    let name = Number(e.querySelector('.name').innerText).toFixed(3);
                    let fixedName = Number(Number(e.querySelector('.name').innerText) - dur + offset).toFixed(3);
                    let values = String(`${String(e.querySelector('.value').innerText).trim()}    `).split(' ');

                    values.forEach(function(val, ind){
                        if (ind < 5 && val != ''){
                            let noteId = String(val).match(/[^-]+-{1,2}[^-]+/g);
                            let noteRotate = String(val).replace(`${noteId}-`, '');
                            let noteWidth = String(noteId).match(/[0-9]+/g);
                            
                            if (String(noteId).indexOf('holdea') != -1){
                                let startArr = searchHoldStartFrame(Number(name).toFixed(3), 'a');

                                if (startArr[0] != -1){
                                    tmp += getHoldHtml(startArr[1], startArr[2], startArr[3], Number(name), noteWidth, noteRotate);
                                };  
                            };
                            if (String(noteId).indexOf('holdeb') != -1){
                                let startArr = searchHoldStartFrame(Number(name).toFixed(3), 'b');
                                
                                if (startArr[0] != -1){
                                    tmp += getHoldHtml(startArr[1], startArr[2], startArr[3], Number(name), noteWidth, noteRotate);
                                };  
                            };
                            if (String(noteId).indexOf('holdec') != -1){
                                let startArr = searchHoldStartFrame(Number(name).toFixed(3), 'c');

                                if (startArr[0] != -1){
                                    tmp += getHoldHtml(startArr[1], startArr[2], startArr[3], Number(name), noteWidth, noteRotate);
                                };  
                            };
                            if (String(noteId).indexOf('holded') != -1){
                                let startArr = searchHoldStartFrame(Number(name).toFixed(3), 'd');

                                if (startArr[0] != -1){
                                    tmp += getHoldHtml(startArr[1], startArr[2], startArr[3], Number(name), noteWidth, noteRotate);
                                };  
                            };
                            if (String(noteId).indexOf('holdee') != -1){
                                let startArr = searchHoldStartFrame(Number(name).toFixed(3), 'e');

                                if (startArr[0] != -1){
                                    tmp += getHoldHtml(startArr[1], startArr[2], startArr[3], Number(name), noteWidth, noteRotate);
                                };  
                            };

                            noteId = String(noteId).replace('holdsa', 'holds');
                            noteId = String(noteId).replace('holdsb', 'holds');
                            noteId = String(noteId).replace('holdsc', 'holds');
                            noteId = String(noteId).replace('holdsd', 'holds');
                            noteId = String(noteId).replace('holdse', 'holds');
                            noteId = String(noteId).replace('holdea', 'holde');
                            noteId = String(noteId).replace('holdeb', 'holde');
                            noteId = String(noteId).replace('holdec', 'holde');
                            noteId = String(noteId).replace('holded', 'holde');
                            noteId = String(noteId).replace('holdee', 'holde');

                            tmp += `
            <!--[${fixedName},${String(e.querySelector('.value').innerText).trim()},${dur}]-->
            <svg class="note" viewBox="-320 -320 640 640" width="640" height="640">
                <symbol id="${noteId}-${noteRotate}" viewBox="-320 -320 640 640">
                    <use href="#${noteId}" transform="rotate(${noteRotate}) scale(0.001)" x="-320" y="-320" width="640" height="640"></use>
                </symbol>
                <use href="#${noteId}-${noteRotate}" x="-320" y="-320" width="640" height="640">
                    <animate attributeName="transform" begin="${fixedName}s" begin-orig="${fixedName}s" dur="${dur}s" repeatCount="1"
                    values="scale(0);scale(40);scale(160);scale(360);scale(640);scale(1000)" keyTimes="0;0.2;0.4;0.6;0.8;1"/>
                </use>
            </svg>`;
                        };
                    });    
                };
            };

            result.value = tmp;
            result.select();
            document.execCommand('Copy');
            alert(`譜面データをコピーしました。
シミュレーターに読み込ませてください。
また、必要に応じてテキストファイルへ控えてください。
控えたデータは、エディターで読み込むことが可能です。`);
        };

        function exportNotesDataSlim(){
            let rows =  document.querySelectorAll('tr');
            let data = [];
            let result = document.getElementById('ipt-note-data');
            let tmp = '';

            for (i = rows.length - 1; i >= 0; i--){
                let e = rows[i];
                
                if (i > 0){
                    let dur = Number(document.getElementById('ipt-duration').value);
                    let offset = Number(document.getElementById('ipt-offset').value);
                    let name = Number(e.querySelector('.name').innerText).toFixed(3);
                    let fixedName = Number(Number(e.querySelector('.name').innerText) - dur + offset).toFixed(3);
                    let values = String(`${String(e.querySelector('.value').innerText).trim()}    `).split(' ');

                    if (tmp != '') tmp += '\n'; 
                    tmp += `<!--[${fixedName},${String(e.querySelector('.value').innerText).trim()},${dur}]-->`;
                };
            };

            result.value = tmp;
            result.select();
            document.execCommand('Copy');
            alert(`譜面データをコピーしました。
必要に応じてテキストファイルへ控えてください。
シミュレーターに読み込ませることはできませんが、
控えたデータは、エディターで読み込むことが可能です。`);
        };

        function importNotesData(){
            if (document.getElementById('ipt-note-data').value == ''){
                alert('譜面データが空です。\n読み込む譜面データを貼り付け、やり直してください。');
            };

            let notes = String(document.getElementById('ipt-note-data').value).match(/\[.+\]/g);
            notes.forEach(function(note, index){
                let noteWithTime = String(String(note).match(/[^\[\]]+/g)).split(',');
                let lastTime = '';
                let lastNote = '';
                if (document.querySelector('td.name')) lastTime = String(document.querySelector('td.name').innerText).trim();
                if (document.querySelector('td.value')) lastNote = String(document.querySelector('td.value').innerText).trim();

                let dur = noteWithTime[2];
                let time = Number(Number(noteWithTime[0]) + Number(dur)).toFixed(3);
                let noteValue = noteWithTime[1];
                let nextNumber = index + 1;

                let noteIconHtml = '';
                if (String(noteValue).match(/touch/g)){
                    noteIconHtml += `
                    <svg class="icon" viewBox="-32 -16 64 128" width="10" height="20">
                        <rect x="-32" y="32" width="64" height="32" fill="deeppink" />
                    </svg>`
                };
                
                if (String(noteValue).match(/holds/g)){
                    noteIconHtml += `
                    <svg class="icon" viewBox="-32 -64 64 128" width="10" height="20">
                        <rect x="-32" y="32" width="64" height="32" fill="olive" />
                        <rect x="-24" y="-64" width="48" height="96" fill="orange" />
                    </svg>`
                };

                if (String(noteValue).match(/holdv/g)){
                    noteIconHtml += `
                    <svg class="icon" viewBox="-32 -64 64 128" width="10" height="20">
                        <rect x="-32" y="32" width="64" height="32" fill="olive" />
                    </svg>`
                };

                if (String(noteValue).match(/holde/g)){
                    noteIconHtml += `
                    <svg class="icon" viewBox="-32 -64 64 128" width="10" height="20">
                        <rect x="-32" y="32" width="64" height="32" fill="olive" />
                    </svg>`
                };

                if (String(noteValue).match(/chain/g)){
                    noteIconHtml += `
                    <svg class="icon" viewBox="-32 -16 64 128" width="10" height="20">
                        <line x1="-32" y1="48" x2="32" y2="48" stroke="gold" stroke-width="32"/>
                        <line x1="-32" y1="48" x2="32" y2="48" stroke="olive" stroke-width="32" stroke-dasharray="16 8" />
                    </svg>`
                };

                if (String(noteValue).match(/left/g)){
                    noteIconHtml += `
                    <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                        <rect x="-32" y="32" width="64" height="32" fill="orange" />
                        <polyline points="20,-24 -20,0 20,24" stroke="orange" stroke-width="16" fill="none" />
                    </svg>`
                };

                if (String(noteValue).match(/right/g)){
                    noteIconHtml += `
                    <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                        <rect x="-32" y="32" width="64" height="32" fill="limegreen" />
                        <polyline points="-20,-24 20,0 -20,24" stroke="limegreen" stroke-width="16" fill="none" />
                    </svg>`
                };

                if (String(noteValue).match(/^in/g) || String(noteValue).match(/;in/g)){
                    noteIconHtml += `
                    <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                        <rect x="-32" y="32" width="64" height="32" fill="orangered" />
                        <polyline points="-32,0 0,-28 32,0" stroke="orangered" stroke-width="16" fill="none" />
                        <polyline points="-32,28 0,0 32,28" stroke="orangered" stroke-width="16" fill="none" />
                    </svg>`
                };

                if (String(noteValue).match(/out/g)){
                    noteIconHtml += `
                    <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                        <rect x="-32" y="32" width="64" height="32" fill="dodgerblue" />
                        <polyline points="-32,-28 0,0 32,-28" stroke="dodgerblue" stroke-width="16" fill="none" />
                        <polyline points="-32,0 0,28 32,0" stroke="dodgerblue" stroke-width="16" fill="none" />
                    </svg>`
                };

                let insertHtml = `
                <tr id="tr-note-${nextNumber}">
                    <td class="number">${nextNumber}</td>
                    <td class="name">${time}</td>
                    <td class="value">${noteIconHtml} ${noteValue}</td>
                    <td class="button">
                        <button class="btn btn-outline-secondary btn-sm" type="button" onclick="jumpTime('${time}', '${noteValue}')">変更</button>
                        <button class="btn btn-outline-danger btn-sm" type="button" onclick="javascript:document.getElementById('tr-note-${nextNumber}').remove()">削除</button>
                    </td>
                </tr>`;
                
                if (lastTime != time){
                    document.getElementById('tbl-notes').insertAdjacentHTML('afterbegin', insertHtml);
                }; 
            });

            alert('読み込みが完了しました。');
        };

        // 最短のホールド終了を含むフレームの検索
        function searchHoldStartFrame(endTime, type){
            let returnArr = [-1, '', '', ''];
            let rows =  document.querySelectorAll('tr');

            rows.forEach(function(e, i){
                let reverseIndex = rows.length - i - 1;
                let name = rows[reverseIndex].querySelector('.name').innerText;
                let value = rows[reverseIndex].querySelector('.value').innerText;
                let pattern = ''
                
                if (type == 'a') pattern = /holdsa-[0-9]+-{1,2}[0-9]+/g;
                if (type == 'b') pattern = /holdsb-[0-9]+-{1,2}[0-9]+/g;
                if (type == 'c') pattern = /holdsc-[0-9]+-{1,2}[0-9]+/g;
                if (type == 'd') pattern = /holdsd-[0-9]+-{1,2}[0-9]+/g;
                if (type == 'e') pattern = /holdse-[0-9]+-{1,2}[0-9]+/g;
                
                if (reverseIndex == 0) return returnArr;
                if (Number(rows[reverseIndex].querySelector('.name').innerText) >= Number(endTime)) return returnArr;

                if (String(value).indexOf(`holds${type}`) != -1){
                    returnArr[0] = reverseIndex;
                    returnArr[1] = String(name).trim(); // 時間
                    returnArr[2] = String(String(value).match(pattern)).match(/[0-9]+/g)[0]; // 幅
                    
                    if (String(String(value).match(pattern)).match(/-/g).length == 2){
                        returnArr[3] = `${String(String(value).match(pattern)).match(/[0-9]+$/g)}`; // 角度
                    };

                    if (String(String(value).match(pattern)).match(/-/g).length == 3){
                        returnArr[3] = `-${String(String(value).match(pattern)).match(/[0-9]+$/g)}`; // 角度
                    };
                };

                if (String(value).indexOf(`holde${type}`) != -1){
                    returnArr[0] = -1;
                    returnArr[1] = '';
                    returnArr[2] = '';
                    returnArr[3] = '';
                };
            });

            return returnArr;
        };

        function getHoldHtml(beginTime, beginWidth, beginRotate, endTime, endWidth, endRotate){
            const interval = 0.015;
            let timeDif = Number(endTime) - Number(beginTime);
            let rotateDif = 0;

            if (Number(beginRotate) >= 0 && Number(endRotate) >= 0 ){
                if (Number(beginRotate) >= Number(endRotate)){
                    rotateDif = Number(endRotate) - Number(beginRotate);
                } else {
                    rotateDif = Number(endRotate) - Number(beginRotate);
                };
            };
            
            if (Number(beginRotate) <= 0 && Number(endRotate) <= 0 ){
                if (Number(beginRotate) >= Number(endRotate)){
                    rotateDif = Number(endRotate) - Number(beginRotate);
                } else {
                    rotateDif = Number(endRotate) - Number(beginRotate);
                };
            };

            if (Number(beginRotate) >= 0 && Number(endRotate) <= 0 ){
                if ((Number(beginRotate) + 180) <= (Number(endRotate) + 360)){
                    rotateDif = Number(endRotate) - Number(beginRotate);
                } else {
                    rotateDif = (Number(endRotate) + 360) - Number(beginRotate);
                };
            };

            if (Number(beginRotate) <= 0 && Number(endRotate) >= 0 ){
                if ((Number(beginRotate) - 180) >= (Number(endRotate) - 360)){
                    rotateDif = Number(endRotate) - Number(beginRotate);
                } else {
                    rotateDif = (Number(endRotate) - 360) - Number(beginRotate);
                };
            };

            let widthDif = Number(endWidth) - Number(beginWidth);
            let step = Number(Math.floor(timeDif / interval));
            let dur = Number(document.getElementById('ipt-duration').value)
            let returnval = '';

            for (let i = 1; i < step; i++){
                let time = Number(Number(beginTime) + (Number(i) * Number(interval)) - Number(dur)).toFixed(3);
                let rotate = Number(Number(beginRotate) + Number(i) * Number(rotateDif) / Number(step)).toFixed(3);
                let width = Number(Number(beginWidth) + Number(i) * Number(widthDif) / Number(step)).toFixed(0);

                returnval += `
            <!-- hold -->
            <svg class="note" viewBox="-320 -320 640 640" width="640" height="640">
                <symbol id="hold-${width}-${rotate}" viewBox="-320 -320 640 640">
                    <use href="#hold-${width}" transform="rotate(${rotate}) scale(0.001)" x="-320" y="-320" width="640" height="640"></use>
                </symbol>
                <use href="#hold-${width}-${rotate}" x="-320" y="-320" width="640" height="640">
                    <animate attributeName="transform" begin="${time}s" begin-orig="${time}s" dur="${dur}s" repeatCount="1"
                    values="scale(0);scale(40);scale(160);scale(360);scale(640);scale(1000)" keyTimes="0;0.2;0.4;0.6;0.8;1"/>
                </use>
            </svg>`
            };

            return returnval;

        };

        function adjustTimelineHeightByInput(){
            let height = document.getElementById('ipt-timeline-height');
            let table = document.getElementById('tbl-notes');
            after = height.value;
            table.setAttribute('style', `height: ${after}`);
        };

        function adjustTimelineHeight(operand){
            let height = document.getElementById('ipt-timeline-height');
            let table = document.getElementById('tbl-notes');
            after = Number(height.value) + Number(operand);
            if (after < 200) after = 200;
            if (Number.isNaN(after)) after = 200;
            height.value = after;
            table.setAttribute('style', `height: ${after}`);
        };

        // 再読み込みの確認
        window.addEventListener('beforeunload', (event) => {
            event.preventDefault();
            event.returnValue = 'tr';
        });
    </script>
</head>
<body>
    <div class="container-fluid m-2">
        <h5>
            CHIE-NO-WA Editor: Lanota Edition (beta v0.52.3)
            <button class="btn btn-outline-secondary ms-2" type="button" onclick="javascript:window.open('entrance.html')">概要</button>
            <button class="btn btn-outline-secondary ms-2" type="button" onclick="javascript:window.open('simulator_lanota.html')">Simulator</button>
        </h5>
        <div class="input-group input-group-sm">
            <span class="input-group-text">履歴</span>
            <input id="ipt-hist-1" type="text" class="form-control" placeholder="" value="" readonly>
            <input id="ipt-hist-2" type="text" class="form-control" placeholder="" value="" readonly>
            <input id="ipt-hist-3" type="text" class="form-control" placeholder="" value="" readonly>
            <input id="ipt-hist-4" type="text" class="form-control" placeholder="" value="" readonly>
            <input id="ipt-hist-5" type="text" class="form-control" placeholder="" value="" readonly>
        </div>
        <div class="input-group input-group-sm">
            <span class="input-group-text">譜面データ</span>
            <textarea id="ipt-note-data" type="text" class="form-control" rows="1" placeholder="" value="" onclick="this.select();"></textarea>
            <button class="btn btn-outline-danger" type="button" onclick="javascript:document.getElementById('ipt-note-data').value = '';">削除</button>
        </div>
        <hr>
        <div class="row">
            <div class="col-1">
                <h5>設定</h5>
            </div>
            <div class="col-11">
                <div class="input-group input-group-sm p-1">
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">プロジェクト</span>
                            <button class="btn btn-outline-secondary" type="button" onclick="importNotesData()">読み込み</button>
                            <button class="btn btn-outline-secondary" type="button" onclick="exportNotesData()">書き出し</button>
                            <button class="btn btn-outline-secondary" type="button" onclick="exportNotesDataSlim()">書き出し(再開データのみ)</button>
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">BPM (Ctrl+T)</span>
                            <input id="ipt-bpm" type="text" class="form-control" placeholder="180" value="180" onchange="getBeatDuration();">
                            <button class="btn btn-outline-secondary" type="button" onclick="adjustBpm(-5)">-5</button>
                            <button class="btn btn-outline-secondary" type="button" onclick="adjustBpm(-1)">-1</button>
                            <button class="btn btn-outline-secondary" type="button" onclick="adjustBpm(+1)">+1</button>
                            <button class="btn btn-outline-secondary" type="button" onclick="adjustBpm(+5)">+5</button>
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1 hidden" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">一小節の拍数 (Ctrl+B)</span>
                            <input id="ipt-beat" type="text" class="form-control" placeholder="4" value="4" onchange="getBeatDuration();">
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">一拍あたりの秒数[秒]</span>
                            <input id="ipt-beat-dur" type="text" class="form-control" placeholder="0" value="0.333" disabled="true">
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1 hidden" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">一小節あたりの秒数[秒]</span>
                            <input id="ipt-measure-dur" type="text" class="form-control" placeholder="0" value="1.333" disabled="true">
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">YouTube動画ID (Ctrl+I)</span>
                            <input id="ipt-play-url" type="text" class="form-control" placeholder="" value="" onclick="this.select();">
                            <button class="btn btn-outline-danger" type="button" onclick="javascript:document.getElementById('ipt-play-url').value = '';">削除</button>
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">再生開始[秒] (Ctrl+B)</span>
                            <input id="ipt-play-begin" type="text" class="form-control" placeholder="" value="0" onchange="this.value = Number(this.value).toFixed(0)">
                            <button class="btn btn-outline-secondary" type="button" onclick="adjustPlayBegin(-5)">-5</button>
                            <button class="btn btn-outline-secondary" type="button" onclick="adjustPlayBegin(-1)">-1</button>
                            <button class="btn btn-outline-secondary" type="button" onclick="adjustPlayBegin(+1)">+1</button>
                            <button class="btn btn-outline-secondary" type="button" onclick="adjustPlayBegin(+5)">+5</button>
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">再生時間[秒] (Ctrl+D)</span>
                            <input id="ipt-play-dur" type="text" class="form-control" placeholder="" value="30" onchange="this.value = Number(this.value).toFixed(0)">
                            <button class="btn btn-outline-secondary" type="button" onclick="adjustPlayDur(-5)">-5</button>
                            <button class="btn btn-outline-secondary" type="button" onclick="adjustPlayDur(-1)">-1</button>
                            <button class="btn btn-outline-secondary" type="button" onclick="adjustPlayDur(+1)">+1</button>
                            <button class="btn btn-outline-secondary" type="button" onclick="adjustPlayDur(+5)">+5</button>
                            <input type="checkbox" class="btn-check" id="btn-play-sync" autocomplete="off">
                            <button id="btn-play" class="btn btn-outline-secondary" type="button" onclick="playVideo();">再生 (Ctrl+P)</button>
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">ノート落下時間[秒] (Ctrl+N)</span>
                            <input id="ipt-duration" type="text" class="form-control" placeholder="0" value="0.750" onchange="this.value = Number(this.value).toFixed(3)">
                            <button id="btn-duration-dl" class="btn btn-outline-secondary" type="button" onclick="adjustDuration(-0.1)">-0.1</button>
                            <button id="btn-duration-ds" class="btn btn-outline-secondary" type="button" onclick="adjustDuration(-0.001)">-0.001</button>
                            <button id="btn-duration-is" class="btn btn-outline-secondary" type="button" onclick="adjustDuration(+0.001)">+0.001</button>
                            <button id="btn-duration-il" class="btn btn-outline-secondary" type="button" onclick="adjustDuration(+0.1)">+0.1</button>
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">ノート落下タイミング[秒] (Ctrl+O)</span>
                            <input id="ipt-offset" type="text" class="form-control" placeholder="0" value="0.000" onchange="this.value = Number(this.value).toFixed(3)">
                            <button id="btn-offset-dl" class="btn btn-outline-secondary" type="button" onclick="adjustOffset(-1)">-1</button>
                            <button id="btn-offset-ds" class="btn btn-outline-secondary" type="button" onclick="adjustOffset(-0.1)">-0.1</button>
                            <button id="btn-offset-is" class="btn btn-outline-secondary" type="button" onclick="adjustOffset(+0.1)">+0.1</button>
                            <button id="btn-offset-il" class="btn btn-outline-secondary" type="button" onclick="adjustOffset(+1)">+1</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-1">
                <h5>移動</h5>
            </div>
            <div class="col-11">
                <div class="input-group input-group-sm pt-1 ps-1 pe-1">
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">時間</span>
                            <input id="ipt-time" type="text" class="form-control" placeholder="0.000" value="1.000" onchange="this.value = Number(this.value).toFixed(3);document.getElementById('ipt-time-detail').value = this.value">
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1 hidden" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">時間</span>
                            <input id="ipt-time-detail" type="text" class="form-control" placeholder="0.000" value="1.000">
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">時間移動</span>
                            <button id="btn-seek-dl" class="btn btn-outline-secondary" type="button" onclick="seekTimeDetail(-0.1);">-0.1 (←)</button>
                            <button id="btn-seek-ds" class="btn btn-outline-secondary" type="button" onclick="seekTimeDetail(-0.001);">-0.001 (↓)</button>
                            <button id="btn-seek-is" class="btn btn-outline-secondary" type="button" onclick="seekTimeDetail(+0.001);">+0.001 (↑)</button>
                            <button id="btn-seek-il" class="btn btn-outline-secondary" type="button" onclick="seekTimeDetail(+0.1);">+0.1 (→)</button>
                        </div>
                    </div>
                </div>
                <div class="input-group input-group-sm pb-1 ps-1 pe-1">
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">移動方向(-で切り替え)</span>
                            <input name="btn-seek-dir" type="radio" class="btn-check" id="btn-seek-back" autocomplete="off" onclick="switchSeekButton('backward')">
                            <label class="btn btn-outline-secondary" for="btn-seek-back">戻る</label>
                            <input name="btn-seek-dir" type="radio" class="btn-check" id="btn-seek-for" autocomplete="off" onclick="switchSeekButton('forward')" checked>
                            <label class="btn btn-outline-secondary" for="btn-seek-for">進む</label>
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">音符移動</span>
                            <button id="btn-seek-4" class="btn btn-outline-danger backward" type="button" onclick="seekTime(4, 4);" style="display: none">-4分 (1)</button>
                            <button id="btn-seek-8" class="btn btn-outline-danger backward" type="button" onclick="seekTime(4, 8);" style="display: none">-8分 (2)</button>
                            <button id="btn-seek-16" class="btn btn-outline-danger backward" type="button" onclick="seekTime(4, 16);" style="display: none">-16分 (3)</button>
                            <button id="btn-seek-16" class="btn btn-outline-danger backward" type="button" onclick="seekTime(4, 32);" style="display: none">-32分 (4)</button>
                            <button id="btn-seek-3" class="btn btn-outline-danger backward" type="button" onclick="seekTime(4, 3);" style="display: none">-3分 (5)</button>
                            <button id="btn-seek-6" class="btn btn-outline-danger backward" type="button" onclick="seekTime(4, 6);" style="display: none">-6分 (6)</button>
                            <button id="btn-seek-12" class="btn btn-outline-danger backward" type="button" onclick="seekTime(4, 12);" style="display: none">-12分 (7)</button>
                            <button id="btn-seek-24" class="btn btn-outline-danger backward" type="button" onclick="seekTime(4, 24);" style="display: none">-24分 (8)</button>
                            <button id="btn-seek-7" class="btn btn-outline-danger backward" type="button" onclick="seekTime(4, 7);" style="display: none">-7分 (9)</button>
                            <button id="btn-seek-14" class="btn btn-outline-danger backward" type="button" onclick="seekTime(4, 14);" style="display: none">-14分 (0)</button>
                            <button id="btn-seek-4" class="btn btn-outline-secondary forward" type="button" onclick="seekTime(4, 4);">+4分 (1)</button>
                            <button id="btn-seek-8" class="btn btn-outline-secondary forward" type="button" onclick="seekTime(4, 8);">+8分 (2)</button>
                            <button id="btn-seek-16" class="btn btn-outline-secondary forward" type="button" onclick="seekTime(4, 16);">+16分 (3)</button>
                            <button id="btn-seek-16" class="btn btn-outline-secondary forward" type="button" onclick="seekTime(4, 32);">+32分 (4)</button>
                            <button id="btn-seek-3" class="btn btn-outline-secondary forward" type="button" onclick="seekTime(4, 3);">+3分 (5)</button>
                            <button id="btn-seek-6" class="btn btn-outline-secondary forward" type="button" onclick="seekTime(4, 6);">+6分 (6)</button>
                            <button id="btn-seek-12" class="btn btn-outline-secondary forward" type="button" onclick="seekTime(4, 12);">+12分 (7)</button>
                            <button id="btn-seek-24" class="btn btn-outline-secondary forward" type="button" onclick="seekTime(4, 24);">+24分 (8)</button>
                            <button id="btn-seek-7" class="btn btn-outline-secondary forward" type="button" onclick="seekTime(4, 7);">+7分 (9)</button>
                            <button id="btn-seek-14" class="btn btn-outline-secondary forward" type="button" onclick="seekTime(4, 14);">+14分 (0)</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-1">
                <h5>配置</h5>
            </div>
            <div class="col-11">
                <div class="input-group input-group-sm pt-1 ps-1 pe-1">
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <input name="btn-note" type="radio" class="btn-check" id="btn-touch" autocomplete="off" onclick="updatePreviewTemp();" checked>
                        <label class="btn btn-outline-secondary" for="btn-touch">
                            <svg class="icon" viewBox="-32 -16 64 128" width="10" height="20">
                                <rect x="-32" y="32" width="64" height="32" fill="deeppink" />
                            </svg>
                            タッチ (Q)
                        </label>
                    
                        <input name="btn-note" type="radio" class="btn-check" id="btn-holds" onclick="updatePreviewTemp();" autocomplete="off">
                        <label class="btn btn-outline-secondary" for="btn-holds">
                            <svg class="icon" viewBox="-32 -64 64 128" width="10" height="20">
                                <rect x="-32" y="32" width="64" height="32" fill="olive" />
                                <rect x="-24" y="-64" width="48" height="96" fill="orange" />
                            </svg>
                            ホールド開始 (W)
                        </label>

                        <input name="btn-note" type="radio" class="btn-check" id="btn-holde" onclick="updatePreviewTemp();" autocomplete="off">
                        <label class="btn btn-outline-secondary" for="btn-holde">
                            <svg class="icon" viewBox="-32 -16 64 128" width="10" height="20">
                                <rect x="-32" y="32" width="64" height="32" fill="olive" />
                            </svg>
                            ホールド終了 (E)
                        </label>
                        
                        <input name="btn-note" type="radio" class="btn-check" id="btn-chain" onclick="updatePreviewTemp();" autocomplete="off">
                        <label class="btn btn-outline-secondary" for="btn-chain">
                            <svg class="icon" viewBox="-32 -16 64 128" width="10" height="20">
                                <line x1="-32" y1="48" x2="32" y2="48" stroke="gold" stroke-width="32"/>
                                <line x1="-32" y1="48" x2="32" y2="48" stroke="olive" stroke-width="32" stroke-dasharray="16 8" />
                            </svg>
                            チェイン (R)
                        </label>

                        <input name="btn-note" type="radio" class="btn-check" id="btn-left" onclick="updatePreviewTemp();" autocomplete="off">
                        <label class="btn btn-outline-secondary" for="btn-left">
                            <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                                <rect x="-32" y="32" width="64" height="32" fill="orange" />
                                <polyline points="20,-24 -20,0 20,24" stroke="orange" stroke-width="16" fill="none" />
                            </svg>
                            左スライド (T)
                        </label>

                        <input name="btn-note" type="radio" class="btn-check" id="btn-right" onclick="updatePreviewTemp();" autocomplete="off">
                        <label class="btn btn-outline-secondary" for="btn-right">
                            <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                                <rect x="-32" y="32" width="64" height="32" fill="limegreen" />
                                <polyline points="-20,-24 20,0 -20,24" stroke="limegreen" stroke-width="16" fill="none" />
                            </svg>
                            右スライド (Y)
                        </label>

                        <input name="btn-note" type="radio" class="btn-check" id="btn-in" onclick="updatePreviewTemp();" autocomplete="off">
                        <label class="btn btn-outline-secondary" for="btn-in">
                            <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                                <rect x="-32" y="32" width="64" height="32" fill="orangered" />
                                <polyline points="-32,0 0,-28 32,0" stroke="orangered" stroke-width="16" fill="none" />
                                <polyline points="-32,28 0,0 32,28" stroke="orangered" stroke-width="16" fill="none" />
                            </svg>
                            内スナップ (U)
                        </label>

                        <input name="btn-note" type="radio" class="btn-check" id="btn-out" onclick="updatePreviewTemp();" autocomplete="off">
                        <label class="btn btn-outline-secondary" for="btn-out">
                            <svg class="icon" viewBox="-32 -48 64 128" width="10" height="20">
                                <rect x="-32" y="32" width="64" height="32" fill="dodgerblue" />
                                <polyline points="-32,-28 0,0 32,-28" stroke="dodgerblue" stroke-width="16" fill="none" />
                                <polyline points="-32,0 0,28 32,0" stroke="dodgerblue" stroke-width="16" fill="none" />
                            </svg>
                            外スナップ (i)
                        </label>
                    </div>
                </div>
                <div class="input-group input-group-sm pb-1 ps-1 pe-1">
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">
                                <svg class="icon" viewBox="-32 -64 64 128" width="10" height="20">
                                    <rect x="-32" y="32" width="64" height="32" fill="olive" />
                                    <rect x="-24" y="-64" width="48" height="96" fill="orange" />
                                </svg>
                                ホールド選択(Hで切り替え)
                            </span>
                            <input name="btn-hold-type" type="radio" class="btn-check" id="btn-hold-a" autocomplete="off" checked>
                            <label class="btn btn-outline-secondary" for="btn-hold-a">A</label>
                            <input name="btn-hold-type" type="radio" class="btn-check" id="btn-hold-b" autocomplete="off">
                            <label class="btn btn-outline-secondary" for="btn-hold-b">B</label>
                            <input name="btn-hold-type" type="radio" class="btn-check" id="btn-hold-c" autocomplete="off">
                            <label class="btn btn-outline-secondary" for="btn-hold-c">C</label>
                            <input name="btn-hold-type" type="radio" class="btn-check" id="btn-hold-d" autocomplete="off">
                            <label class="btn btn-outline-secondary" for="btn-hold-d">D</label>
                            <input name="btn-hold-type" type="radio" class="btn-check" id="btn-hold-e" autocomplete="off">
                            <label class="btn btn-outline-secondary" for="btn-hold-e">E</label>
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">レーン幅</span>
                            <input id="ipt-width" type="text" class="form-control" placeholder="0" value="4" onchange="this.value = Number(this.value).toFixed(0);adjustWidthByInput(this.value);" disabled>
                            <button id="btn-width-dl" class="btn btn-outline-secondary" type="button" onclick="adjustWidth(-5);" disabled>-5 (A)</button>
                            <button id="btn-width-ds" class="btn btn-outline-secondary" type="button" onclick="adjustWidth(-1);" disabled>-1 (S)</button>
                            <button id="btn-width-is" class="btn btn-outline-secondary" type="button" onclick="adjustWidth(+1);" disabled>+1 (D)</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustWidth(+5);" disabled>+5 (F)</button>
                            <span class="input-group-text">プリセット</span>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustWidthByInput(4);" disabled>4</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustWidthByInput(8);" disabled>8</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustWidthByInput(15);" disabled>15</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustWidthByInput(30);" disabled>30</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustWidthByInput(45);" disabled>45</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustWidthByInput(60);" disabled>60</button>
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">角度</span>
                            <input id="ipt-rotate" type="text" class="form-control" placeholder="0" value="0" onchange="this.value = Number(this.value).toFixed(0);adjustRotateByInput(this.value);">
                            <button id="btn-rotate-dl" class="btn btn-outline-secondary" type="button" onclick="adjustRotate(30);">← 30° (J)</button>
                            <button id="btn-rotate-ds" class="btn btn-outline-secondary" type="button" onclick="adjustRotate(6);">← 6° (K)</button>
                            <button id="btn-rotate-is" class="btn btn-outline-secondary" type="button" onclick="adjustRotate(-6);">→ 6° (L)</button>
                            <button id="btn-rotate-il" class="btn btn-outline-secondary" type="button" onclick="adjustRotate(-30);">→ 30° (:;)</button>
                            <button id="btn-rotate-fl" class="btn btn-outline-secondary" type="button" onclick="adjustRotateFlip();">左右反転 (,)</button>
                            <button id="btn-rotate-ud" class="btn btn-outline-secondary" type="button" onclick="adjustRotate(180);">上下反転 (.)</button>
                            <button id="btn-rotate-0" class="btn btn-outline-secondary" type="button" onclick="adjustRotate0();">0に戻す (/)</button>
                            <span class="input-group-text">プリセット</span>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustRotateByInput(180);">上</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustRotateByInput(90);">左</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustRotateByInput(0);">下</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustRotateByInput(-90);">右</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustRotateByInput(36);">レーンA</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustRotateByInput(12);">レーンB</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustRotateByInput(-12);">レーンC</button>
                            <button id="btn-width-il" class="btn btn-outline-secondary" type="button" onclick="adjustRotateByInput(-36);">レーンD</button>
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">※ コンソール最下部は0°､ 左方向(右回転)がプラス､ 右方向(左回転)がマイナスです｡</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-1">
                <h5>ノート</h5>
            </div>
            <div class="col-11">
                <div class="input-group input-group-sm p-1">
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">1</span>
                            <input id="ipt-note-1" type="text" class="form-control" placeholder="1つ目のノート" value="">
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">2</span>
                            <input id="ipt-note-2" type="text" class="form-control" placeholder="2つ目のノート" value="">
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">3</span>
                            <input id="ipt-note-3" type="text" class="form-control" placeholder="3つ目のノート" value="">
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">4</span>
                            <input id="ipt-note-4" type="text" class="form-control" placeholder="4つ目のノート" value="">
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">5</span>
                            <input id="ipt-note-5" type="text" class="form-control" placeholder="5つ目のノート" value="">
                            
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">ノート</span>
                            <button id="btn-insert" class="btn btn-outline-primary" type="button" onclick="insertNote();">配置 (Space)</button>
                            <button id="btn-copy" class="btn btn-outline-success" type="button" onclick="copyLastNote();">最後のフレームをコピー (Shift+Space)</button>
                            <button id="btn-delete" class="btn btn-outline-danger" type="button" onclick="deleteNote();">最後のノートを削除 (BackSpace)</button>
                            <button id="btn-apply" class="btn btn-outline-secondary" type="button" onclick="applyInserts();">挿入/変更を反映 (Enter)</button>
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">※ ノートは､ 配置した順に下から重なります｡</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row hidden">
            <div class="col-1">
                <h5>メニュー</h5>
            </div>
            <div class="col-11">
                <div class="input-group input-group-sm p-1">
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">履歴</span>
                            <button class="btn btn-outline-secondary" type="button" disabled>元に戻す (Ctrl+Z)</button>
                            <button class="btn btn-outline-secondary" type="button" disabled>やり直し (Ctrl+Y)</button>
                        </div>
                    </div>
                    <div class="btn-group btn-group-sm p-1" role="group">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text">編集</span>
                            <button class="btn btn-outline-secondary" type="button" disabled>切り取り (Ctrl+X)</button>
                            <button class="btn btn-outline-secondary" type="button" disabled>コピー (Ctrl+C)</button>
                            <button class="btn btn-outline-secondary" type="button" disabled>貼り付け (Ctrl+V)</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <hr>

        <div class="container-fluid">
            <div class="row">
                <div class="col-2">
                    <h5>プレビュー</h5>
                    <div class="play-area d-flex align-items-start">
                        <svg id="defs" class="preview" viewBox="-320 -320 640 640" width="0" height="0">
                            <defs class="back">
                                <!-- ノーツ以外の塗り色 -->
                                <radialGradient id="dimmer-fill" cx="50%" cy="50%" r="50%">
                                    <stop offset="0%" stop-color="dimgray"></stop>
                                    <stop offset="85%" stop-color="black"></stop>
                                </radialGradient>
                                <linearGradient id="judge-fill" x1="0%" y1="100%" x2="100%" y2="0%">
                                    <stop offset="0%" stop-color="yellow"></stop>
                                    <stop offset="50%" stop-color="turquoise"></stop>
                                    <stop offset="100%" stop-color="yellow"></stop>
                                </linearGradient>
            
                                <!-- 背景 -->
                                <symbol id="bg" viewBox="-320 -320 640 640">
                                    <circle cx="0" cy="0" r="320" stroke="none" fill="url(#dimmer-fill)"></circle>
                                </symbol>
            
                                <!-- 判定ライン -->
                                <symbol id="judge" viewBox="-320 -320 640 640">
                                    <circle cx="0" cy="0" r="300" stroke="url(#judge-fill)" stroke-width="16" fill="none"></circle>
                                    <circle cx="0" cy="0" r="300" stroke="black" stroke-width="8" stroke-opacity="0.25" fill="none"></circle>
                                </symbol>
            
                                <!-- ガイドラインの素材 -->
                                <symbol id="guide-src" viewBox="-320 -320 640 640">
                                    <line x1="0" y1="-320" x2="0" y2="320" stroke="white" stroke-width="1" stroke-opacity="0.250"></line>
                                </symbol>
            
                                <!-- ガイドライン -->
                                <symbol id="guide-a" viewBox="-320 -320 640 640">
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(0)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(6)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(12)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(18)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(24)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(30)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(36)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(42)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(48)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(54)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(60)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(66)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(72)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(78)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(84)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(90)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(96)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(102)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(108)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(114)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(120)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(126)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(132)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(138)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(144)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(150)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(156)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(162)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(168)"></use>
                                    <use x="-320" y="-320" href="#guide-src" transform="rotate(174)"></use>
                                </symbol>
                            </defs>
            
                            <defs class="notes-fill">
                                <!-- 塗り色の定義 -->
                                <linearGradient id="in-a-fill-1" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="white"></stop>
                                    <stop offset="100%" stop-color="firebrick"></stop>
                                </linearGradient>
                                <linearGradient id="in-a-fill-2" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="white"></stop>
                                    <stop offset="40%" stop-color="firebrick"></stop>
                                </linearGradient>
                                <linearGradient id="out-a-fill-1" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="white"></stop>
                                    <stop offset="100%" stop-color="dodgerblue"></stop>
                                </linearGradient>
                                <linearGradient id="out-a-fill-2" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="white"></stop>
                                    <stop offset="40%" stop-color="dodgerblue"></stop>
                                </linearGradient>
                                <linearGradient id="left-fill" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="khaki"></stop>
                                    <stop offset="100%" stop-color="orange"></stop>
                                </linearGradient>
                                <linearGradient id="right-fill" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="white"></stop>
                                    <stop offset="100%" stop-color="limegreen"></stop>
                                </linearGradient>
                            </defs>
            
                            <defs class="notes-touch">
                                <!-- タッチノーツの定義 -->
                                <symbol id="touch-4" viewBox="-320 -320 640 640">
                                    <path d="M 62,293 a 300 300 78 0 1 -124,0" stroke="darkgoldenrod" stroke-width="16" fill="none"></path>
                                    <path d="M 47,296 a 300 300 81 0 1 -94,0" stroke="white" stroke-width="12" fill="none"></path>
                                </symbol>
                            </defs>
            
                            <defs class="notes-chain">
                                <!-- タッチノーツの定義 -->
                                <symbol id="chain-4" viewBox="-320 -320 640 640">
                                    <path d="M 62,293 a 300 300 78 0 1 -124,0" stroke="darkgoldenrod" stroke-width="16" fill="none"></path>
                                    <path d="M 47,296 a 300 300 81 0 1 -94,0" stroke="dodgerblue" stroke-width="12" fill="none"></path>
                                    <path d="M 47,296 a 300 300 81 0 1 -94,0" stroke="darkgoldenrod" stroke-width="2" fill="none"></path>
                                    <path d="M 31,298 a 300 300 84 0 1 -62,0" stroke="darkgoldenrod" stroke-width="4" fill="none"></path>
                                </symbol>
                            </defs>
            
                            <defs class="notes-hold">
                                <!-- ホールドノーツ端点の定義 -->
                                <symbol id="hold-4" viewBox="-320 -320 640 640">
                                    <path d="M 16,300 a 300 300 87 0 1 -32,0" stroke="dodgerblue" stroke-width="12" fill="none"></path>
                                </symbol>
                            </defs>

                            <defs class="notes-holds">
                                <!-- ホールドノーツ端点の定義 -->
                                <symbol id="holds-4" viewBox="-320 -320 640 640">
                                    <path d="M 62,293 a 300 300 78 0 1 -124,0" stroke="darkgoldenrod" stroke-width="16" fill="none"></path>
                                    <path d="M 47,296 a 300 300 81 0 1 -94,0" stroke="dodgerblue" stroke-width="12" fill="none"></path>
                                    <path d="M 47,296 a 300 300 81 0 1 -94,0" stroke="darkgoldenrod" stroke-width="2" fill="none"></path>
                                    <path d="M 31,298 a 300 300 84 0 1 -62,0" stroke="darkgoldenrod" stroke-width="4" fill="none"></path>
                                </symbol>         
                            </defs>
            
                            <defs class="notes-holde">
                                <!-- ホールドノーツ端点の定義 -->
                                <symbol id="holde-4" viewBox="-320 -320 640 640">
                                    <path d="M 62,293 a 300 300 78 0 1 -124,0" stroke="darkgoldenrod" stroke-width="16" fill="none"></path>
                                    <path d="M 47,296 a 300 300 81 0 1 -94,0" stroke="dodgerblue" stroke-width="12" fill="none"></path>
                                    <path d="M 47,296 a 300 300 81 0 1 -94,0" stroke="darkgoldenrod" stroke-width="2" fill="none"></path>
                                    <path d="M 31,298 a 300 300 84 0 1 -62,0" stroke="darkgoldenrod" stroke-width="4" fill="none"></path>
                                </symbol>             
                            </defs>

                            <defs class="notes-in">
                                <symbol id="in-a" viewBox="-320 -320 640 640">
                                    <g stroke-linejoin="miter" stroke-miterlimit="6" stroke="firebrick" stroke-width="2" transform="translate(0 16)">
                                        <polygon points="-15,275 0,240 15,275 15,290 0,255 -15,290" fill="url(#in-a-fill-2)"></polygon>
                                    </g>
                                </symbol>
                                <symbol id="in-4" viewBox="-320 -320 640 640">
                                    <path d="M 62,293 a 300 300 78 0 1 -124,0" stroke="darkgoldenrod" stroke-width="16" fill="none"></path>
                                    <path d="M 47,296 a 300 300 81 0 1 -94,0" stroke="tomato" stroke-width="12" fill="none"></path>
                                    <use transform="rotate(0)" x="-300" y="-300" width="600" height="600" href="#in-a"></use>
                                </symbol>
                            </defs>
            
                            <defs class="notes-out">
                                <symbol id="out-a" viewBox="-320 -320 640 640">
                                    <g stroke-linejoin="miter" stroke-miterlimit="6" stroke="dodgerblue" stroke-width="2" transform="translate(0 16)">
                                        <polygon points="-15,240 0,275 15,240 15,255 0,290 -15,255" fill="url(#out-a-fill-2)"></polygon>
                                    </g>
                                </symbol>
                                <symbol id="out-4" viewBox="-320 -320 640 640">
                                    <path d="M 62,293 a 300 300 78 0 1 -124,0" stroke="darkgoldenrod" stroke-width="16" fill="none"></path>
                                    <path d="M 47,296 a 300 300 81 0 1 -94,0" stroke="mediumaquamarine" stroke-width="12" fill="none"></path>
                                    <use transform="rotate(0)" x="-300" y="-300" width="600" height="600" href="#out-a"></use>
                                </symbol>
                            </defs>
            
                            <defs class="notes-left">
                                <symbol id="left-a-md" viewBox="-320 -320 640 640">
                                    <polygon points="15,263 0,275 15,287 0,287 -15,275 0,263" transform="rotate(0) translate(0 10)" stroke="orange" fill="url(#left-fill)" stroke-width="2"></polygon>
                                </symbol>
                                <symbol id="left-4" viewBox="-320 -320 640 640">
                                    <path d="M 62,293 a 300 300 78 0 1 -124,0" stroke="darkgoldenrod" stroke-width="16" fill="none"></path>
                                    <path d="M 47,296 a 300 300 81 0 1 -94,0" stroke="gold" stroke-width="12" fill="none"></path>
                                    <use transform="rotate(0)" x="-300" y="-300" width="600" height="600" href="#left-a-md"></use>
                                </symbol>
                            </defs>
            
                            <defs class="notes-right">
                                <symbol id="right-a-md" viewBox="-320 -320 640 640">
                                    <polygon points="0,263 15,275 0,287 -15,287 0,275 -15,263" transform="rotate(0) translate(0 10)" stroke="limegreen" fill="url(#right-fill)" stroke-width="2"></polygon>
                                </symbol>
                                <symbol id="right-4" viewBox="-320 -320 640 640">
                                    <path d="M 62,293 a 300 300 78 0 1 -124,0" stroke="darkgoldenrod" stroke-width="16" fill="none"></path>
                                    <path d="M 47,296 a 300 300 81 0 1 -94,0" stroke="greenyellow" stroke-width="12" fill="none"></path>
                                    <use transform="rotate(0)" x="-300" y="-300" width="600" height="600" href="#right-a-md"></use>
                                </symbol>
                            </defs>
                        </svg>
                        
                        <svg id="plate" class="preview" viewBox="-320 -320 640 640" width="640" height="640">
                            <use x="-320" y="-320" width="640" height="640" href="#bg"></use>
                            <use x="-320" y="-320" width="640" height="640" href="#guide-a"></use>
                            <use x="-320" y="-320" width="640" height="640" href="#judge"></use>
                        </svg>

                        <svg class="preview" viewBox="-320 -320 640 640" width="640" height="640">
                            <use id="svg-note-1" x="-320" y="-320" width="640" height="640" href="" transform="rotate(0)"></use>
                        </svg>

                        <svg class="preview" viewBox="-320 -320 640 640" width="640" height="640">
                            <use id="svg-note-2" x="-320" y="-320" width="640" height="640" href="" transform="rotate(0)"></use>
                        </svg>

                        <svg class="preview" viewBox="-320 -320 640 640" width="640" height="640">
                            <use id="svg-note-3" x="-320" y="-320" width="640" height="640" href="" transform="rotate(0)"></use>
                        </svg>

                        <svg class="preview" viewBox="-320 -320 640 640" width="640" height="640">
                            <use id="svg-note-4" x="-320" y="-320" width="640" height="640" href="" transform="rotate(0)"></use>
                        </svg>

                        <svg class="preview" viewBox="-320 -320 640 640" width="640" height="640">
                            <use id="svg-note-5" x="-320" y="-320" width="640" height="640" href="" transform="rotate(0)"></use>
                        </svg>

                        <svg class="preview" viewBox="-320 -320 640 640" width="640" height="640">
                            <use id="svg-note-temp" x="-320" y="-320" width="640" height="640" href="#touch-4" transform="rotate(0)" opacity="0.6"></use>
                        </svg>
                        
                    </div>
                </div>
                <div class="col-6">
                    <h5 id="input">
                        タイムライン
                        <div class="btn-group btn-group-sm ps-2 w-50" role="group">
                            <div class="input-group input-group-sm">
                                <span class="input-group-text">表示の高さ[px]</span>
                                <input id="ipt-timeline-height" type="text" class="form-control" placeholder="" value="200" onchange="adjustTimelineHeightByInput();">
                                <button class="btn btn-outline-secondary" type="button" onclick="adjustTimelineHeight(+100);">+100</button>
                            </div>
                        </div>
                    </h5>
                    <table class="table">
                        <thead>
                            <tr>
                                <th class="number">#</th>
                                <th class="name">Time</th>
                                <th class="value">Value</th>
                                <th class="button"></th>
                            </tr>
                        </thead>
                        <tbody id="tbl-notes" style="height: 200px;">
                        </tbody>
                    </table>
                </div>
                <div class="col-2">
                    <h5 id="input">動画</h5>
                    <div id="player"></div>

                    <script>
                        var tag = document.createElement('script');

                        tag.src = "https://www.youtube.com/iframe_api";
                        var firstScriptTag = document.getElementsByTagName('script')[0];
                        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                        var player;
                        function onYouTubeIframeAPIReady() {
                            player = new YT.Player('player', {
                                height: '180',
                                width: '320',
                                videoId: '',
                                events: {
                                'onReady': onPlayerReady,
                                'onStateChange': onPlayerStateChange
                                }
                            });
                        };

                        function onPlayerReady(event) {
                            event.target.playVideo();
                        };

                        var done = false;
                        function onPlayerStateChange(event) {
                            if (event.data == YT.PlayerState.PLAYING && !done) {
                                done = true;
                            };
                        };
                        function stopVideo() {
                            player.stopVideo();
                        };
                    </script>

                    <div class="input-group input-group-sm">
                        <span class="input-group-text">※ 一度再生するまではエラーが表示されますが、異常ではありません。</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
